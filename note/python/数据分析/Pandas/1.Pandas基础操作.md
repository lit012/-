# Pandas基础

参考网址：`https://blog.csdn.net/qq_44921056/article/details/115419404`

pandas，python+data+analysis的组合缩写，是python中基于numpy和matplotlib的第三方数据分析库，与后两者共同构成了python数据分析的基础工具包，享有数分三剑客之名。

安装（使用清华源）：

```bash
pip install pandas -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install numpy -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install matplotlib -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## series

series是一个一维数组，线性的数据结构。

### 创建

**(1) pandas.Series()**

```python
import pandas as pd

# 创建一个series数据,默认索引值
s1 = pd.Series([1, 3, 14, 521])
print(s1)
```

```bash
0      1
1      3
2     14
3    521
dtype: int64
```

```python
import pandas as pd

# 创建一个series数据,索引值自定义
s2 = pd.Series([1, 3, 14, 521], index=['第一个数', '第二个数', '第三个数', '第四个数'])
print(s2)
```

```bash
第一个数      1
第二个数      3
第三个数     14
第四个数    521
dtype: int64
```

**(2) 字典构建**

```python
import pandas as pd

dict = {"数学": 130, "专业课": 140, "政治": 80, "英语": 70}
s4 = pd.Series(dict)
print(s4)
```

```bash
数学     130
专业课    140
政治      80
英语      70
dtype: int64
```

### 访问

**(1) pandas.values()**

```python
import pandas as pd

# 提取series的数据的值
s3 = pd.Series([1, 3, 14, 521])
# 直接获取值
print(s3.values)
print('-------分割线-------')
# 根据索引获取值
print(s3[0:3])
```

```bash
[  1   3  14 521]
-------分割线-------
0     1
1     3
2    14
dtype: int64
```


## dataframe

### 创建

**(1) pandas.DataFrame()**

```python
import pandas as pd

# 创建一个空 DataFrame
df = pd.DataFrame(columns=['a', 'b', 'c'])

# 使用 loc 添加一行
df.loc[0] = ['dfafoisj', 'dfafsdfasj', 'dffdafsj']  # 添加第一行
df.loc[1] = ['dfafoisj', 'dfdfsfafoisj', 'dffdafsj']  # 添加第二行

print(df)
```

```python
import pandas as pd

data = {
    'class': [1, 2, 3, 4],
    'people': [16, 15, 17, 18]
}
df1 = pd.DataFrame(data)
print(df1)
```

```bash
   class  people
0      1      16
1      2      15
2      3      17
3      4      18
```

利用np.arange()函数

```python
import pandas as pd
import numpy as np
df2 = pd.DataFrame(np.arange(8).reshape(2, 4))
print(df2)
```

```bash
   0  1  2  3
0  0  1  2  3
1  4  5  6  7
```

自定义行和列的值

```python
import pandas as pd
import numpy as np
df3 = pd.DataFrame(np.arange(8).reshape(2, 4), index=['a', 'b'], columns=['11', '22', '33', '44'])
print(df3)
```

```bash
   11  22  33  44
a   0   1   2   3
b   4   5   6   7
```

### 访问

#### (1) 获取值、行索引、列索引、转置

使用values、index、columns、axes、T

```python
import pandas as pd
import numpy as np
df4 = pd.DataFrame(np.arange(8).reshape(2, 4), index=['a', 'b'], columns=['11', '22', '33', '44'])
print('--------原数据-------')
print(df4)
print('-------获取值--------')
print(df4.values)
print('-------获取行索引--------')
print(df4.index)
print('-------获取列索引--------')
print(df4.columns)
print('-------获取行及列的索引值--------')
print(df4.axes)
print('-------获取转置-------')
print(df4.T)
```

```bash
--------原数据-------
   11  22  33  44
a   0   1   2   3
b   4   5   6   7
-------获取值--------
[[0 1 2 3]
 [4 5 6 7]]
-------获取行索引--------
Index(['a', 'b'], dtype='object')
-------获取列索引--------
Index(['11', '22', '33', '44'], dtype='object')
-------获取行及列的索引值--------
[Index(['a', 'b'], dtype='object'), Index(['11', '22', '33', '44'], dtype='object')]
-------获取转置值-------
    a  b
11  0  4
22  1  5
33  2  6
44  3  7
```

#### (2) pandas.describe()获取统计变量

```python
import pandas as pd

data = {'year': [2018, 2019, 2020, 2021],
        'income': [10000, 20000, 30000, 40000],
        'pay': [5000, 15000, 20000, 30000]
}
df5 = pd.DataFrame(data)
print(df5.describe())
```

```bash
              year        income           pay
count     4.000000      4.000000      4.000000
mean   2019.500000  25000.000000  17500.000000
std       1.290994  12909.944487  10408.329997
min    2018.000000  10000.000000   5000.000000
25%    2018.750000  17500.000000  12500.000000
50%    2019.500000  25000.000000  17500.000000
75%    2020.250000  32500.000000  22500.000000
max    2021.000000  40000.000000  30000.000000
```

```
count：数量统计，此列共有多少有效值
mean：均值
std：标准差
min：最小值
25%：四分之一分位数
50%：二分之一分位数
75%：四分之三分位数
max：最大值
```

#### (3) sort_index()、sort_values()排序

```python
import pandas as pd
import numpy as np
df6 = pd.DataFrame(np.arange(8).reshape(2, 4), index=['b', 'a'], columns=['22', '11', '44', '33'])
print('--------原数据-------')
print(df6)
print('--------行排序-------')
print(df6.sort_index(axis=0))
print('--------列排序-------')
print(df6.sort_index(axis=1))
print('--------值排序(对33列里的值进行排序)-------')
print(df6.sort_values(by='33'))
```

```bash
--------原数据-------
   22  11  44  33
b   0   1   2   3
a   4   5   6   7
--------行排序-------
   22  11  44  33
a   4   5   6   7
b   0   1   2   3
--------列排序-------
   11  22  33  44
b   1   0   3   2
a   5   4   7   6
--------值排序(对33列里的值进行排序)-------
   22  11  44  33
b   0   1   2   3
a   4   5   6   7
```

#### (4) 切片访问数据

```python
df[start:end:step]
```

- start：起始索引（包括该行），默认为 0。
- end：结束索引（不包括该行），如果未指定，默认为最后一行。
- step：步长，表示每隔多少行选取一次，默认为 1。

访问前n行

```python
# 访问前 3 行
df_first_3 = df[:3]
print(df_first_3)
```

访问后n行

```python
# 访问后 4 行
df_last_4 = df[len(df) - 4:]  # 或者 df[-4:]
print(df_last_4)
```

指定行开始，隔行访问

```python
# 从第 2 行开始，每隔一行
df_every_other = df[1::2]  # 从索引 1 开始，每隔一行
print(df_every_other)
```

指定行与列名访问

```python
# 选择特定行和列
df_slice = df.loc[1:3, ['name', 'age']]  # 选择行 1 到 3，列 'name' 和 'age'
print(df_slice)
```
指定行与列索引值访问

```python
# 选择特定行和列
df_slice = df.iloc[1:4, 1:3]  # 选择行 1 到 3，列 1 到 2
print(df_slice)
```

#### (5) apply()遍历

`apply()` 是 Pandas 中一个非常强大的函数，用于在 DataFrame 的行或列上应用自定义函数。它可以让你在处理数据时更加灵活和高效。

```python
DataFrame.apply(func, axis=0, raw=False, result_type=None, args=(), **kwds)
```

- func: 要应用的函数，可以是一个 Python 函数或 NumPy 函数。
- axis: 指定函数应用的方向：
   - 0 或 'index'：对每一列应用函数（默认）。
   - 1 或 'columns'：对每一行应用函数。
- raw: 如果为 True，则传递给函数的是 ndarray 而不是 Series。
- result_type: 影响返回结果的形状。
- args: 传递给函数的位置参数。
- kwds: 传递给函数的关键字参数。

对每一列应用函数：

```python
import pandas as pd

df = pd.DataFrame({
    'A': [1, 2, 3],
    'B': [4, 5, 6]
})

# 计算每列的和
column_sum = df.apply(sum)
print(column_sum)
```

对每一行应用函数：

```python
# 计算每行的和
row_sum = df.apply(sum, axis=1)
print(row_sum)
```

使用自定义函数：

```python
# 自定义函数
def add_columns(row):
    return row['A'] + row['B']

# 对每一行应用自定义函数
df['C'] = df.apply(add_columns, axis=1)
print(df)
```

传递额外参数：

```python
def multiply_columns(row, factor):
    return (row['A'] + row['B']) * factor

df['D'] = df.apply(multiply_columns, axis=1, args=(2,))
print(df)
```

虽然 `apply()` 很方便，但在处理大型 `DataFrame` 时可能会比较慢。对于某些操作（如简单的数学运算），使用 `Pandas` 提供的向量化操作（例如 `+, -, *, /`）通常会更快。尽量在可能的情况下避免使用 `apply()`。

#### (6) 单独访问行或列

##### 访问某一行或列

使用行索引访问行，列名访问列。

```python
import pandas as pd

# 创建一个示例DataFrame
data = {
    'X1': [1, 2, 3, 4, 5],
    'X2': [5, 4, 3, 2, 1],
    'Y': [5, 4, 3, 2, 1]
}
df = pd.DataFrame(data)

# 访问某一列
column_data = df['X1']  # 获取'X1'列的所有数据

# 访问某一行
row_data = df.iloc[0]  # 获取第一行的所有数据
```

##### 列名列表访问多个列

使用列名列表访问多个列。

```python
# 访问多个列
multiple_columns_data = df[['X1', 'X2']]  # 获取'X1'和'X2'列的所有数据
```

返回一个新的dataframe。




### 增加数据

**(1) 添加新列**

赋值添加：

```python
import pandas as pd

# 创建示例 DataFrame
df = pd.DataFrame({
    'A': [1, 2, 3],
    'B': [4, 5, 6]
})

# 添加新列 C
df['C'] = [7, 8, 9]
print(df)
```

**(2) loc或者iloc添加新行**

```python
# 添加新行
df.loc[len(df)] = [4, 10, 11]
print(df)
```

