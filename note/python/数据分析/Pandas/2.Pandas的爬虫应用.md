# Pandas在爬虫中的应用

## 格式转换

### 字典转换为dataframe

**(1) 无嵌套单个字典转换**

```python
import pandas as pd

# 示例字典
data = {
    'name': 'Alice',
    'age': '25',
    'city': 'New York'
}

# 转换为 DataFrame
df = pd.DataFrame([data])  # 使用列表将字典包裹起来

print(df)
```

```bash
   name age      city
0  Alice  25  New York
```

**(2) 无嵌套多个字典转换**

```python
import pandas as pd

# 示例字典列表
data = [
    {'name': 'Alice', 'age': 25, 'city': 'New York'},
    {'name': 'Bob', 'age': 30, 'city': 'Los Angeles'},
    {'name': 'Charlie', 'age': 35, 'city': 'Chicago'}
]

# 转换为 DataFrame
df = pd.DataFrame(data)

print(df)
```

```bash
      name  age         city
0    Alice   25     New York
1      Bob   30  Los Angeles
2  Charlie   35      Chicago
```

## 数据检验

### dataframe检验是否有空数据

在 pandas 中，你可以使用 isnull() 或 isna() 方法结合 any() 来检查 DataFrame 中是否有空值。s

```python
import pandas as pd

# 示例 DataFrame
data = {
    'id': [1, 2, 3],
    'name': ['Alice', None, 'Charlie'],
    'age': [25, 30, None]
}

df = pd.DataFrame(data)

# 检查是否有空值
has_null = df.isnull().any().any()  # 检查整个 DataFrame

print("DataFrame 中是否有空值:", has_null)

# 检查特定列是否有空值，例如 'name'
has_null_name = df['name'].isnull().any()
print("'name' 列是否有空值:", has_null_name)
```

```bash
DataFrame 中是否有空值: True
'name' 列是否有空值: True
```

- isnull() 会返回一个与 DataFrame 相同形状的布尔值 DataFrame，其中空值为 True。
- any() 方法用于检查布尔值 DataFrame 中是否有 True 值。
- 第一个 any() 检查每一列是否有空值，返回一个布尔 Series。
- 第二个 any() 检查整个 Series 是否有 True 值。
- 如果只想检查特定列，可以直接对该列使用 isnull() 和 any()。

## 数据过滤

### dataframe删除多余数据

**(1) drop_duplicates()根据列值去重复行**

```python
import pandas as pd

# 示例 DataFrame
data = {
    'id': [1, 2, 2, 3, 4, 4],
    'name': ['Alice', 'Bob', 'Bob', 'Charlie', 'David', 'David'],
    'age': [25, 30, 30, 35, 40, 40]
}

df = pd.DataFrame(data)

# 打印原始 DataFrame
print("原始 DataFrame:")
print(df)

# 根据 'id' 列去重，但不更新索引值
df_unique = df.drop_duplicates(subset='id')

# 打印去重后的 DataFrame
print("\n去重后的 DataFrame:")
print(df_unique)
```

```bash
原始 DataFrame:
   id     name  age
0  1   Alice   25
1  2     Bob   30
2  2     Bob   30
3  3 Charlie   35
4  4   David   40
5  4   David   40

去重后的 DataFrame:
   id     name  age
0  1   Alice   25
1  2     Bob   30
3  3 Charlie   35
4  4   David   40
```

如果需要更新索引值，可以使用reset_index(drop=True)

```python
# 根据 'id' 列去重并重置索引
df_unique = df.drop_duplicates(subset='id').reset_index(drop=True)
```

**(2) drop()根据列名去除多余列**

drop(index=[...])或者drop(columns=[...])可以去除不想要的行或者列。

```python
import pandas as pd

# 示例 DataFrame
data = {
    'id': [1, 2, 3],
    'name': ['Alice', 'Bob', 'Charlie'],
    'age': [25, 30, 35],
    'city': ['New York', 'Los Angeles', 'Chicago']
}

df = pd.DataFrame(data)

# 打印原始 DataFrame
print("原始 DataFrame:")
print(df)

# 删除不需要的列，例如 'age' 和 'city'
df_dropped = df.drop(columns=['age', 'city'])

# 打印删除后的 DataFrame
print("\n删除后的 DataFrame:")
print(df_dropped)
```

```bash
原始 DataFrame:
   id     name  age         city
0  1   Alice   25     New York
1  2     Bob   30  Los Angeles
2  3 Charlie   35      Chicago

删除后的 DataFrame:
   id     name
0  1   Alice
1  2     Bob
2  3 Charlie
```

**(3) df.dropna()删除包含空值的行**

```python
import pandas as pd

# 示例 DataFrame
data = {
    'id': [1, 2, 3, 4],
    'name': ['Alice', None, 'Charlie', 'David'],
    'age': [25, 30, None, 40]
}

df = pd.DataFrame(data)

# 打印原始 DataFrame
print("原始 DataFrame:")
print(df)

# 去掉包含空值的行
df_cleaned = df.dropna()

# 打印去掉空值后的 DataFrame
print("\n去掉空值后的 DataFrame:")
print(df_cleaned)
```

```bash
原始 DataFrame:
   id     name   age
0  1   Alice  25.0
1  2    None  30.0
2  3 Charlie   NaN
3  4   David  40.0

去掉空值后的 DataFrame:
   id     name   age
0  1   Alice  25.0
3  4   David  40.0
```

如果你只想根据特定列去掉包含空值的行，可以使用 subset 参数：

```python
df_cleaned = df.dropna(subset=['name', 'age'])
```

## 数据保存

### 保存在excel

首先确保安装了`openpyxl` 或 `xlrd` 库，这些库用于处理 Excel 文件。

```bash
pip install openpyxl xlrd
```

**(1) 读取excel**

```python
import pandas as pd

# 读取 Excel 文件
df = pd.read_excel('file.xlsx', sheet_name='Sheet1')  # 指定表单名称

# 打印 DataFrame
print(df)
```

**(2) 写入excel**

```python
# 将 DataFrame 写入 Excel 文件
df.to_excel('output.xlsx', sheet_name='Sheet1', index=False)  # index=False 不写入索引列
```

**(3) 多表单读取**

```python
# 读取所有表单
dfs = pd.read_excel('file.xlsx', sheet_name=None)  # 返回一个字典，键为表单名称，值为对应的 DataFrame

# 打印所有表单的 DataFrame
for sheet_name, data in dfs.items():
    print(f"Sheet: {sheet_name}")
    print(data)
```

**(4) 多表单写入**

```python
with pd.ExcelWriter('output_multiple_sheets.xlsx') as writer:
    df1.to_excel(writer, sheet_name='Sheet1', index=False)
    df2.to_excel(writer, sheet_name='Sheet2', index=False)
```
